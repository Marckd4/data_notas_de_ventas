{% extends 'base.html' %}

{% block content %}

<h1 class="mb-4">Solicitud de Mercader√≠a</h1>

<!-- BUSCADOR -->
<div class="mb-3">
    <input id="filtroTabla" type="text" class="form-control form-control-lg"
           placeholder="üîç Buscar en la tabla... (Descripci√≥n, C√≥digo, √Årea, Solicitante, etc.)">
</div>

<style>
    /* Contenedor con scroll vertical y horizontal */
    .tabla-scroll {
        max-height: 600px;       /* Aprox. 15 filas visibles */
        overflow-y: auto;
        overflow-x: auto;
        border: 2px solid #ddd;
        border-radius: 6px;
        padding: 0;
        background: white;
    }

    /* Cabecera fija */
    .tabla-scroll thead th {
        position: sticky;
        top: 0;
        z-index: 5;
        background-color: #0d6efd !important;
        color: white;
        white-space: nowrap;   /* Evita que la cabecera salte de l√≠nea */
    }

    /* Ajuste de columnas extensas */
    table td, table th {
        white-space: nowrap;   /* Permite scroll horizontal */
    }

    /* Animaci√≥n suave al filtrar */
    tr {
        transition: all 0.2s ease-in-out;
    }
</style>

<!-- CONTENEDOR SCROLLABLE -->
<div class="tabla-scroll mb-3">

    <table class="table table-bordered table-striped table-hover text-center align-middle">
        <thead class="table-primary">
            <tr>
                <th>Fecha</th>
                <th>Cod_DUN</th>
                <th>Cod_EAN</th>
                <th>Cod_Sistema</th>
                <th>Descripci√≥n</th>
                <th>√Årea</th>
                <th>Solicitante</th>
                <th>Cant. Solicitada</th>
                <th>Status</th>
                <th>Cant. Enviada</th>
                <th>Chofer</th>
                <th>Factura / Gu√≠a</th>
                <th>Acciones</th>
            </tr>
        </thead>

        <tbody id="tablaPedidos">
            {% for p in pedidos %}
            <tr>
                <td>{{ p.fecha_solicitud }}</td>
                <td>{{ p.cod_dun }}</td>
                <td>{{ p.cod_ean }}</td>
                <td>{{ p.cod_sistema }}</td>
                <td>{{ p.descripcion }}</td>
                <td>{{ p.area_solicitud }}</td>
                <td>{{ p.nombre_solicitante }}</td>
                <td>{{ p.cantidad_solicitada }}</td>
                <td>{{ p.status_prioridades }}</td>
                <td>{{ p.cant_enviada_bsf }}</td>
                <td>{{ p.chofer }}</td>
                <td>{{ p.factura_guia }}</td>

                <td style="min-width: 150px;">
                    <a href="{% url 'pedidos:editar' p.id %}" class="btn btn-warning btn-sm">Editar</a>

                    <form action="{% url 'pedidos:eliminar' p.id %}" method="post" style="display:inline-block;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger btn-sm"
                                onclick="return confirm('¬øSeguro que deseas eliminar este registro?')">
                            Eliminar
                        </button>
                    </form>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="13">No hay pedidos registrados.</td>
            </tr>
            {% endfor %}
        </tbody>

    </table>

</div>

<a href="{% url 'inicio' %}" class="btn btn-secondary">
    ‚Üê Volver al inicio
</a>

<!-- JS ‚Äî FILTRO EN TIEMPO REAL -->
<script>
    document.getElementById('filtroTabla').addEventListener('keyup', function () {
        const filtro = this.value.toLowerCase();
        const filas = document.querySelectorAll('#tablaPedidos tr');

        filas.forEach(fila => {
            const texto = fila.innerText.toLowerCase();
            fila.style.display = texto.includes(filtro) ? '' : 'none';
        });
    });
</script>

{% endblock %}
